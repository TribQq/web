<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <title>try_try_2</title>

</head>

<body>
    <canvas id='screen' style='width: 640px; height: 640px;' />

    <script>
        function Scene(screen, controls) {
            this.canvas = screen.canvas;
            this.ctx = this.canvas.getContext('2d');
            this.controls = controls;
            this.imgs = screen.imgs;

        }


        function Lib(screen, controls) {
            Scene.apply(this, arguments);
            this.assets = [{
                name: 'tyan',
                path: 'assets/tyan.png'
            }, {
                name: 'player',
                path: 'assets/player.png'
            }, {
                name: 'sceleton',
                path: 'assets/sceleton.png'
            }, {
                name: 'bg',
                path: 'assets/tiles.png'
            }, {
                name: 'title',
                path: 'assets/title.jpg'
            }];

            this.total = this.assets.length;
            this.loaded = 0;
            this.status = "loading";


            this.loaded_at = 0;

            var self = this;
            for (var i = 0; i < this.total; i++) {
                var img = new Image();
                img.onload = function() {
                    self.loaded++;
                };
                img.src = self.assets[i].path;
                screen.imgs[self.assets[i].name] = img;

            }

        }

        Lib.prototype = Object.create(Scene.prototype);
        Lib.prototype.constructor = Lib;

        Lib.prototype.render = function(time) {
            if (this.status == "loading") {
                if (this.loaded == this.total) {
                    this.status = "loaded";
                    this.loaded_at = time;
                }
                this.ctx.fillStyle = '#000000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.fillStyle = '#ffffff';
                this.ctx.font = "22px Georgia";
                this.ctx.fillText("Loading " + this.loaded + '/' + this.total, 50, 70);
                return "lib";
            }

            if (this.status == "loaded") {
                if ((time - this.loaded_at) > 1000) {
                    return "menu";
                } else {
                    return "lib";
                }
            }

        }

        function Win(screen, controls) {
            Scene.apply(this, arguments);
        }

        Win.prototype = Object.create(Scene.prototype);
        Win.prototype.constructor = Win;


        Win.prototype.render = function(time) {
            this.ctx.fillStyle = '#000000';
            this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
            this.ctx.fillStyle = '#ffffff';
            this.ctx.font = "22px Georgia";
            this.ctx.fillText("You won!Nice shot duDe!(￢_￢;)..", 50, 70);
            return "win";
        };

        function Menu(screen, controls) {
            Scene.apply(this, arguments);
        }

        Menu.prototype = Object.create(Scene.prototype);
        Menu.prototype.constructor = Menu;


        Menu.prototype.render = function(time) {

            this.ctx.drawImage(this.imgs['title'],
                0, 0, 600, 600,
                0, 0, 600, 600);

            this.ctx.fillStyle = '#FFFFFF';
            this.ctx.font = "22px Arial";
            this.ctx.fillText("Нажмите пробел", 250, 500);
            if (this.controls.states['fire']) {
                return "game";
            } else {
                return "menu";
            }
        };


        function Game(screen, controls) {
            Scene.apply(this, arguments);

            this.camera = new Camera(0, 0, this);
            this.player = new Player(100, 64, this);
            this.monster = new Player(96, 128, this);
            this.monster.type = "monster";
            this.monster.status = "walking";
            this.sounds = {};
            this.sounds['arrow'] = new Sound('assets/arrow.wav');
            this.sounds['sword'] = new Sound('assets/sword.wav');
            this.map = []
    </script>

</body>

</html>